"use strict";!function(){function e(e){for(var t=e.querySelectorAll(".content__date"),n=new Date,o=n.getDate(),a=n.getMonth(),r=n.getFullYear(),c=0,s=t.length;c<s;c++){var i=new Date(t[c].innerText),m=i.getMinutes(),l=i.getDate(),d=i.getMonth(),u=i.getFullYear(),p=o-l,v=i.getHours()+":"+(m<10?"0":"")+m;t[c].innerText=r===u?a===d?0===p?"Dziś o "+v:1===p?"Wczoraj o "+v:p+" dni temu":l+" "+y[d]:l+" "+y[d]+" "+u,$(t[c]).show(0)}}function t(e){$.ajax({type:"POST",url:N,data:e,success:function(t){e.commentId=t,i[0].reset(),a(),L=0,n(e),A.push(e.commentText),T++,C=$(_)},error:o})}function n(t){for(var n="",o=$("#commentHiddenTemplate").children().clone()[0],a=0;a<t.numOfStars;a++)n+="&#9733;";o.getElementsByClassName("comment__content")[0].classList.add("comment__content--new","js-new-comment"),o.getElementsByTagName("img")[0].setAttribute("src",t.commentAvatar),o.getElementsByClassName("content__author")[0].innerText=t.commentAuthor,o.getElementsByClassName("content__rate")[0].innerHTML=n,o.getElementsByClassName("content__text")[0].innerText=t.commentText,o.getElementsByClassName("content__date")[0].innerText=Date();var r=o.getElementsByClassName("dropdown-wrapper__menu")[0];r.setAttribute("data-commentId",t.commentId),r.setAttribute("data-comIndex",T),e(o),$(o.outerHTML).prependTo(w).promise().done(function(){setTimeout(function(){var e=document.getElementsByClassName("js-new-comment");e.length>0&&e[e.length-1].classList.remove("comment__content--new","js-new-comment")},1e4)})}function o(e,t,n){console.log("Error",e,t,n)}function a(){for(var e=0;e<x;e++)r[e].innerHTML="&#9734;",r[e].classList.remove(v)}for(var r=document.querySelectorAll("#rate span"),c=document.getElementById("landpage"),s=document.getElementById("aboutUsButton"),i=(document.getElementById("loginAlert"),$("#formNewComment")),m=document.getElementById("formNewCommentWrapper"),l=document.querySelectorAll(".panel--comments__comments-wrapper .comments-wrapper__comment"),d="display--none",u="visibility--visible",p="form-new-comment--wrapper--visible",v="rate-by-stars--hover",f="comments-wrapper__comment--half-visible",h="collapse__buttons--active",g="landpage--visible",b=".content__dropdown-wrapper",_=".dropdown-wrapper__menu",w="#commentsWrapper",y=["stycznia","lutego","marca","kwietnia","maja","czerwca","lipca","sierpnia","września","października","listopada","grudnia"],x=r.length,L=0,T=l.length,E=!1,N="https://evening-hamlet-47726.herokuapp.com",A=[],C=$(_),I=l.length-1;I>=0;I--)A.push(l[I].childNodes[3].childNodes[7].innerText.trim());/^http\:\/\/localhost/.test(window.location.href)&&(N="http://localhost:3000"),function(){for(var e=0;e<T;e++){var t=l[e].childNodes[3].childNodes[7],n=t.innerText.trim();if(n.length>150){var o='<button class="show-whole-text" data-comIndex="'+(T-1-e)+'">...zobacz więcej</button>';t.innerText=n.slice(0,150)+"(..)",t.insertAdjacentHTML("beforeend",o)}}}(),$(w).on("click",".show-whole-text",function(){var e=this.getAttribute("data-comIndex");this.parentNode.innerText=A[e]}),$(w).on("click",".comments-wrapper__comment--half-visible",function(){var e=document.querySelectorAll(".comments-wrapper__comment.display--none");this.classList.remove(f),E=!0;for(var t=0,n=e.length;t<n;t++)e[t].classList.remove(d)}),s.addEventListener("click",function(){$(c).remove(),this.classList.add(h)}),"#about-us"===window.location.hash&&(c.classList.remove(g),$(c).remove()),c.addEventListener("transitionend",function(){$(c).remove()}),$("#button-getStarted").one("click",function(){$(this).removeClass("pulse"),c.classList.remove(g),c.classList.add("landpage--hidden"),s.classList.add(h)}),function(){function e(e){r[e].innerHTML="&#9733;",r[e].classList.add(v)}for(var t=0;t<x;t++)r[t].addEventListener("click",function(){L=this.getAttribute("value"),document.querySelector("#rateNum").setAttribute("value",L),a();for(var t=0;t<L;t++)e(t)}),r[t].addEventListener("mouseenter",function(){a();for(var t=0;t<this.getAttribute("value");t++)e(t)}),r[t].addEventListener("mouseleave",function(){a();for(var t=0;t<L;t++)e(t)})}(),e(document),$(w).on("click",b,function(){var e=$(this).find(_);C.not(e).removeClass(u),e.toggleClass(u)}),$(document).on("click",function(e){$(e.target).closest(b).length||C.removeClass(u)}),document.getElementById("button-addOpinion").addEventListener("click",function(){this.classList.add("visibility--hidden"),m.classList.add(p)}),$("#button-sendOpinion").click(function(){var e={numOfStars:i.find("#rateNum").val(),commentText:i.find("#text").val(),commentAvatar:i.find("#avatar").val(),commentAuthor:i.find("#currentuser").val()};e.numOfStars&&e.commentText&&t(e)}),$(w).on("click",".button-DeleteComment",function(){function e(e){var t=e.parentNode.parentNode.parentNode;t.parentNode.removeChild(t)}function t(){if(!E){var e=document.querySelector(".comments-wrapper__comment.comments-wrapper__comment--half-visible"),t=document.querySelector(".comments-wrapper__comment.display--none");e&&(e.classList.remove(f),t&&(t.classList.remove(d),t.classList.add(f)))}}var n=this,a={commentId:this.parentNode.getAttribute("data-commentId")};$.ajax({type:"DELETE",url:N,data:a,success:function(){e(n),t()},error:o})}),function(){var e=document.getElementsByClassName("dropdown-wrapper__button"),t={};$(w).on("click",".button-EditComment",function(){function n(e,t){for(var n=0,o=e.length;n<o;n++)"add"===t?e[n].classList.add(d):e[n].classList.remove(d)}function a(e){$.ajax({type:"PUT",url:N,data:e,success:function(){r(e.newText)},error:o})}function r(e){i.innerText=e,A[c]=e}var c=this.parentNode.getAttribute("data-comIndex"),s="<form id='edit-form' class='content__edit-form'>\n                        <textarea id='text-area' class='edit-form__textarea'>"+A[c]+"</textarea>\n                        <div class='edit-form__buttons-container'>\n                          <button type='button' id='buttonAccept' class='button button--small button--accept'>Zatwierdź</button>\n                          <button type='button' id='buttonCancel' class='button button--small button--cancel'>Anuluj</button>\n                        </div>\n                      </form>",i=this.parentNode.parentNode.parentNode.childNodes[3].childNodes[7];t.commentId=this.parentNode.getAttribute("data-commentId"),i.innerHTML=s,document.getElementById("buttonAccept").addEventListener("click",function(){t.newText=document.getElementById("text-area").value,t.newText!==A[c]&&(a(t),n(e,"remove"))}),document.getElementById("buttonCancel").addEventListener("click",function(){i.innerText=A[c],n(e,"remove")}),n(e,"add")})}()}();