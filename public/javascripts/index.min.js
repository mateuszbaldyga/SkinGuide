"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),initIndex=function(){function t(){g.length>D&&($(g[D]).off(),$(g[D+1]).on("click",function(){N=!0,g[D+1].classList.remove(C);for(var t=D+2,e=g.length;t<e;t++)g[t].classList.remove(y)}))}function e(t){for(var e=t.querySelectorAll(".content__date"),n=new j,o=n.getDay(),a=n.getMonth(),r=n.getYear(),i=0,s=e.length;i<s;i++){var c=new Date(e[i].innerText),l=c.getMinutes(),m=c.getDate(),u=c.getMonth()+1,d=c.getFullYear(),f=o-m,v=c.getHours()+":"+(l<10?"0":"")+l;e[i].innerText=r==d?a==u?0===f?"Dziś o "+v:1===f?"Wczoraj o "+v:f+" dni temu":m+" "+k[u]:m+" "+k[u]+" "+d,$(e[i]).show(0)}}function n(t){var e=t?$(t):$(document.querySelectorAll(T)),n=e.find(E);e.each(function(){var t=this;$(this).off().on("click",function(){var e=$(t).find(E);n.not(e).removeClass(b),e.toggleClass(b)})}),$(document).on("click",function(t){$(t.target).closest(T).length||n.removeClass(b)})}function o(t){$.ajax({type:"POST",url:S,data:t,success:function(e){t.commentId=e,h[0].reset(),u(),B=0,a(t),r(),s(),D++},error:m})}function a(t){for(var o="",a=$("#commentHiddenTemplate").children().clone()[0],r=0;r<t.numOfStars;r++)o+="&#9733;";a.getElementsByClassName("comment__content")[0].classList.add("comment__content--new","js-new-comment"),a.getElementsByTagName("img")[0].setAttribute("src",t.commentAvatar),a.getElementsByClassName("content__author")[0].innerText=t.commentAuthor,a.getElementsByClassName("content__rate")[0].innerHTML=o,a.getElementsByClassName("content__text")[0].innerText=t.commentText,a.getElementsByClassName("content__date")[0].innerText=Date(),$(a.getElementsByClassName("button-DeleteComment")[0]).parent().attr("data",t.commentId),e(a),$(a.outerHTML).prependTo("#commentsWrapper").promise().done(function(){setTimeout(function(){var t=document.getElementsByClassName("js-new-comment");t.length>0&&t[t.length-1].classList.remove("comment__content--new","js-new-comment")},1e4)}),n(document.querySelectorAll(T))}function r(){$(".button-DeleteComment").each(function(){var t=this;$(this).on("click",function(){var e={commentId:$.trim($(t).parent().attr("data"))};$.ajax({type:"DELETE",url:S,data:e,success:i($(t)),error:m})})})}function i(e){e.closest(".comments-wrapper__comment").remove(),N||(D<g.length&&g[D].classList.remove(C),D+1<g.length&&(g[D+1].classList.remove(y),g[D+1].classList.add(C),t()))}function s(){var t=$(".button-EditComment"),e=$(document.querySelectorAll(".dropdown-wrapper__button"));t.each(function(){var t=this;$(this).on("click",function(){var n={commentId:$(t).parent().attr("data")},o=$(t).closest("div.comments-wrapper__comment"),a=o.find("div.content__text"),r=a.text().trim(),i="<form id='edit-form' class='content__edit-form'>\n                            <textarea id='text-area' class='edit-form__textarea'>"+r+"</textarea>\n                            <div class='edit-form__buttons-container'>\n                              <button type='button' id='buttonAccept' class='button button--small button--accept'>Zatwierdź</button>\n                              <button type='button' id='buttonCancel' class='button button--small button--cancel'>Anuluj</button>\n                            </div>\n                          </form>";e.addClass(y),a.replaceWith(i).promise().done(function(){var t=o.find("#edit-form");o.find("#buttonAccept").on("click",function(){n.editFormText=t.find("#text-area").val();var o=a.text(n.editFormText),i={editForm:t,newTextDiv:o,btnToggleDropdown:e};n.editFormText!==r&&c(n,i)}),o.find("#buttonCancel").on("click",function(){t.replaceWith(a),e.removeClass(y)})})})})}function c(t,e){$.ajax({type:"PUT",url:S,data:t,success:function(){l(e)},error:m})}function l(t){t.editForm.replaceWith(t.newTextDiv),t.btnToggleDropdown.removeClass(y)}function m(t,e,n){console.log("Error",t,e,n)}function u(){for(var t=0;t<A;t++)d[t].innerHTML="&#9734;",d[t].classList.remove(w)}var d=document.querySelectorAll("#rate span"),f=document.getElementById("landpage"),v=document.getElementById("aboutUsButton"),h=(document.getElementById("loginAlert"),$("#formNewComment")),p=document.getElementById("formNewCommentWrapper"),g=document.getElementsByClassName("comments-wrapper__comment"),y="display--none",b="visibility--visible",_="form-new-comment--wrapper--visible",w="rate-by-stars--hover",C="comments-wrapper__comment--half-visible",x="collapse__buttons--active",L="landpage--visible",T=".content__dropdown-wrapper",E=".dropdown-wrapper__menu",k=["0","stycznia","lutego","marca","kwietnia","maja","czerwca","lipca","sierpnia","września","października","listopada","grudnia"],A=d.length,B=0,D=4,N=!1,S="https://evening-hamlet-47726.herokuapp.com";/^http\:\/\/localhost/.test(window.location.href)&&(S="http://localhost:3000");var j=function(){function t(){_classCallCheck(this,t),this.today=new Date,this.dd=this.today.getDate(),this.mm=this.today.getMonth()+1,this.yyyy=this.today.getFullYear()}return _createClass(t,[{key:"getDay",value:function(){return this.dd<10&&(this.dd="0"+this.dd),this.dd}},{key:"getMonth",value:function(){return this.mm<10&&(this.mm="0"+this.mm),this.mm}},{key:"getYear",value:function(){return this.yyyy}}]),t}();t(),v.addEventListener("click",function(){f.remove(),this.classList.add(x)}),"#about-us"===window.location.hash&&(f.classList.remove(L),f.remove()),f.addEventListener("transitionend",function(){this.remove()}),$("#button-getStarted").one("click",function(){$(this).removeClass("pulse"),f.classList.remove(L),f.classList.add("landpage--hidden"),v.classList.add(x)}),function(){function t(t){d[t].innerHTML="&#9733;",d[t].classList.add(w)}for(var e=0;e<A;e++)d[e].addEventListener("click",function(){B=this.getAttribute("value"),document.querySelector("#rateNum").setAttribute("value",B),u();for(var e=0;e<B;e++)t(e)}),d[e].addEventListener("mouseenter",function(){u();for(var e=0;e<this.getAttribute("value");e++)t(e)}),d[e].addEventListener("mouseleave",function(){u();for(var e=0;e<B;e++)t(e)})}(),e(document),n(),document.getElementById("button-addOpinion").addEventListener("click",function(){this.classList.add("visibility--hidden"),p.classList.add(_)}),$("#button-sendOpinion").click(function(){var t={numOfStars:h.find("#rateNum").val(),commentText:h.find("#text").val(),commentAvatar:h.find("#avatar").val(),commentAuthor:h.find("#currentuser").val()};t.numOfStars&&t.commentText&&o(t)}),r(),s()}();