"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),initIndex=function(){function t(){p>A&&($(g[A]).off(),$(g[A+1]).on("click",function(){I=!0,g[A+1].classList.remove(E);for(var t=A+2;t<p;t++)g[t].classList.remove(y)}))}function e(t){for(var e=t.querySelectorAll(".content__date"),n=new S,o=n.getDay(),a=n.getMonth(),s=n.getYear(),i=0,c=e.length;i<c;i++){var r=new Date(e[i].innerText),l=r.getMinutes(),m=r.getDate(),u=r.getMonth()+1,d=r.getFullYear(),f=o-m,v=r.getHours()+":"+(l<10?"0":"")+l;e[i].innerText=s==d?a==u?0===f?"Dziś o "+v:1===f?"Wczoraj o "+v:f+" dni temu":m+" "+x[u]:m+" "+x[u]+" "+d,$(e[i]).show(0)}}function n(t){var e=t?$(t):$(document.querySelectorAll(T)),n=e.find(k);e.each(function(){var t=this;$(this).off().on("click",function(){var e=$(t).find(k);n.not(e).removeClass(b),e.toggleClass(b)})}),$(document).on("click",function(t){$(t.target).closest(T).length||n.removeClass(b)})}function o(t){$.ajax({type:"POST",url:D,data:t,success:function(e){t.commentId=e,v[0].reset(),l(),N=0,a(t),s(),c(!0),A++},error:r})}function a(t){for(var o="",a=$("#commentHiddenTemplate").children().clone()[0],s=0;s<t.numOfStars;s++)o+="&#9733;";a.getElementsByClassName("comment__content")[0].classList.add("comment__content--new","js-new-comment"),a.getElementsByTagName("img")[0].setAttribute("src",t.commentAvatar),a.getElementsByClassName("content__author")[0].innerText=t.commentAuthor,a.getElementsByClassName("content__rate")[0].innerHTML=o,a.getElementsByClassName("content__text")[0].innerText=t.commentText,a.getElementsByClassName("content__date")[0].innerText=Date(),$(a.getElementsByClassName("button-DeleteComment")[0]).parent().attr("data",t.commentId),e(a),$(a.outerHTML).prependTo("#commentsWrapper").promise().done(function(){setTimeout(function(){var t=document.getElementsByClassName("js-new-comment");t.length>0&&t[t.length-1].classList.remove("comment__content--new","js-new-comment")},1e4)}),n(document.querySelectorAll(T))}function s(){$(".button-DeleteComment").each(function(){var t=this;0===m(this,"click")&&$(this).on("click",function(){var e={commentId:$.trim($(t).parent().attr("data"))};$.ajax({type:"DELETE",url:D,data:e,success:i($(t)),error:r})})})}function i(e){e.closest(".comments-wrapper__comment").remove(),I||(A<p&&g[A].classList.remove(E),A+1<p&&(g[A+1].classList.remove(y),g[A+1].classList.add(E),t()))}function c(){for(var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=document.getElementsByClassName("dropdown-wrapper__button"),n=document.getElementsByClassName("button-EditComment"),o=t?2:n.length,a={},s=1;s<o;s++)n[s].addEventListener("click",function(){function t(t,e){for(var n=0,o=t.length;n<o;n++)"add"===e?t[n].classList.add(y):t[n].classList.remove(y)}function n(t){console.log(t),$.ajax({type:"PUT",url:D,data:t,success:function(){o(t.newText)},error:r})}function o(t){c.innerText=t}console.log("click");var s=p-1-this.getAttribute("comId"),i="<form id='edit-form' class='content__edit-form'>\n                          <textarea id='text-area' class='edit-form__textarea'>"+j[s]+"</textarea>\n                          <div class='edit-form__buttons-container'>\n                            <button type='button' id='buttonAccept' class='button button--small button--accept'>Zatwierdź</button>\n                            <button type='button' id='buttonCancel' class='button button--small button--cancel'>Anuluj</button>\n                          </div>\n                        </form>",c=g[s].childNodes[3].childNodes[7];a.commentId=this.parentNode.getAttribute("data"),c.innerHTML=i,document.getElementById("buttonAccept").addEventListener("click",function(){console.log("click"),a.newText=document.getElementById("text-area").value,n(a),t(e,"remove")}),document.getElementById("buttonCancel").addEventListener("click",function(){c.innerText=j[s],t(e,"remove"),console.log("click")}),t(e,"add")})}function r(t,e,n){}function l(){for(var t=0;t<B;t++)u[t].innerHTML="&#9734;",u[t].classList.remove(w)}function m(t,e){var n=$._data($(t).get(0),"events");return void 0===n?0:n[e].length}for(var u=document.querySelectorAll("#rate span"),d=document.getElementById("landpage"),f=document.getElementById("aboutUsButton"),v=(document.getElementById("loginAlert"),$("#formNewComment")),h=document.getElementById("formNewCommentWrapper"),g=document.getElementsByClassName("comments-wrapper__comment"),p=g.length,y="display--none",b="visibility--visible",_="form-new-comment--wrapper--visible",w="rate-by-stars--hover",E="comments-wrapper__comment--half-visible",L="collapse__buttons--active",C="landpage--visible",T=".content__dropdown-wrapper",k=".dropdown-wrapper__menu",x=["0","stycznia","lutego","marca","kwietnia","maja","czerwca","lipca","sierpnia","września","października","listopada","grudnia"],B=u.length,N=0,A=4,I=!1,D="https://evening-hamlet-47726.herokuapp.com",j=[],M=0;M<p;M++)j.push(g[M].childNodes[3].childNodes[7].innerText.trim());/^http\:\/\/localhost/.test(window.location.href)&&(D="http://localhost:3000");var S=function(){function t(){_classCallCheck(this,t),this.today=new Date,this.dd=this.today.getDate(),this.mm=this.today.getMonth()+1,this.yyyy=this.today.getFullYear()}return _createClass(t,[{key:"getDay",value:function(){return this.dd<10&&(this.dd="0"+this.dd),this.dd}},{key:"getMonth",value:function(){return this.mm<10&&(this.mm="0"+this.mm),this.mm}},{key:"getYear",value:function(){return this.yyyy}}]),t}();t(),f.addEventListener("click",function(){$(d).remove(),this.classList.add(L)}),"#about-us"===window.location.hash&&(d.classList.remove(C),$(d).remove()),d.addEventListener("transitionend",function(){$(d).remove()}),$("#button-getStarted").one("click",function(){$(this).removeClass("pulse"),d.classList.remove(C),d.classList.add("landpage--hidden"),f.classList.add(L)}),function(){function t(t){u[t].innerHTML="&#9733;",u[t].classList.add(w)}for(var e=0;e<B;e++)u[e].addEventListener("click",function(){N=this.getAttribute("value"),document.querySelector("#rateNum").setAttribute("value",N),l();for(var e=0;e<N;e++)t(e)}),u[e].addEventListener("mouseenter",function(){l();for(var e=0;e<this.getAttribute("value");e++)t(e)}),u[e].addEventListener("mouseleave",function(){l();for(var e=0;e<N;e++)t(e)})}(),e(document),n(),document.getElementById("button-addOpinion").addEventListener("click",function(){this.classList.add("visibility--hidden"),h.classList.add(_)}),$("#button-sendOpinion").click(function(){var t={numOfStars:v.find("#rateNum").val(),commentText:v.find("#text").val(),commentAvatar:v.find("#avatar").val(),commentAuthor:v.find("#currentuser").val()};t.numOfStars&&t.commentText&&o(t)}),s(),c()}();