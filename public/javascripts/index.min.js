"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),initIndex=function(){function t(){y.length>D&&($(y[D]).off(),$(y[D+1]).on("click",function(){S=!0,y[D+1].classList.remove(x);for(var t=D+2,e=y.length;t<e;t++)y[t].classList.remove(b)}))}function e(t){for(var e=t.querySelectorAll(".content__date"),n=new I,o=n.getDay(),a=n.getMonth(),i=n.getYear(),s=0,r=e.length;s<r;s++){var c=new Date(e[s].innerText),l=c.getMinutes(),m=c.getDate(),u=c.getMonth()+1,d=c.getFullYear(),f=o-m,v=c.getHours()+":"+(l<10?"0":"")+l;e[s].innerText=i==d?a==u?0===f?"Dziś o "+v:1===f?"Wczoraj o "+v:f+" dni temu":m+" "+B[u]:m+" "+B[u]+" "+d,$(e[s]).show(0)}}function n(t){var e=t?$(t):$(document.querySelectorAll(T)),n=e.find(k);e.each(function(){var t=this;$(this).off().on("click",function(){var e=$(t).find(k);n.not(e).removeClass(_),e.toggleClass(_)})}),$(document).on("click",function(t){$(t.target).closest(T).length||n.removeClass(_)})}function o(t){$.ajax({type:"POST",url:j,data:t,success:function(e){t.commentId=e,p[0].reset(),u(),N=0,a(t),i(),r(),D++},error:m})}function a(t){for(var o="",a=$("#commentHiddenTemplate").children().clone()[0],i=0;i<t.numOfStars;i++)o+="&#9733;";a.getElementsByClassName("comment__content")[0].classList.add("comment__content--new","js-new-comment"),a.getElementsByTagName("img")[0].setAttribute("src",t.commentAvatar),a.getElementsByClassName("content__author")[0].innerText=t.commentAuthor,a.getElementsByClassName("content__rate")[0].innerHTML=o,a.getElementsByClassName("content__text")[0].innerText=t.commentText,a.getElementsByClassName("content__date")[0].innerText=Date(),$(a.getElementsByClassName("button-DeleteComment")[0]).parent().attr("data",t.commentId),e(a),$(a.outerHTML).prependTo("#commentsWrapper").promise().done(function(){setTimeout(function(){var t=document.getElementsByClassName("js-new-comment");t.length>0&&t[t.length-1].classList.remove("comment__content--new","js-new-comment")},1e4)}),n(document.querySelectorAll(T))}function i(){$(".button-DeleteComment").each(function(){var t=this;0===d(this,"click")&&$(this).on("click",function(){var e={commentId:$.trim($(t).parent().attr("data"))};$.ajax({type:"DELETE",url:j,data:e,success:s($(t)),error:m})})})}function s(e){e.closest(".comments-wrapper__comment").remove(),S||(D<y.length&&y[D].classList.remove(x),D+1<y.length&&(y[D+1].classList.remove(b),y[D+1].classList.add(x),t()))}function r(){var t=$(".button-EditComment"),e=$(document.querySelectorAll(".dropdown-wrapper__button"));t.each(function(){var t=this;0===d(this,"click")&&$(this).on("click",function(){var n={commentId:$(t).parent().attr("data")},o=$(t).closest("div.comments-wrapper__comment"),a=o.find("div.content__text"),i=a.text().trim(),s="<form id='edit-form' class='content__edit-form'>\n                              <textarea id='text-area' class='edit-form__textarea'>"+i+"</textarea>\n                              <div class='edit-form__buttons-container'>\n                                <button type='button' id='buttonAccept' class='button button--small button--accept'>Zatwierdź</button>\n                                <button type='button' id='buttonCancel' class='button button--small button--cancel'>Anuluj</button>\n                              </div>\n                            </form>";e.addClass(b),a.replaceWith(s).promise().done(function(){var t=o.find("#edit-form");o.find("#buttonAccept").on("click",function(){n.editFormText=t.find("#text-area").val();var o=a.text(n.editFormText),s={editForm:t,newTextDiv:o,btnToggleDropdown:e};n.editFormText!==i&&c(n,s)}),o.find("#buttonCancel").on("click",function(){t.replaceWith(a),e.removeClass(b)})})})})}function c(t,e){$.ajax({type:"PUT",url:j,data:t,success:function(){l(e)},error:m})}function l(t){t.editForm.replaceWith(t.newTextDiv),t.btnToggleDropdown.removeClass(b)}function m(t,e,n){}function u(){for(var t=0;t<A;t++)f[t].innerHTML="&#9734;",f[t].classList.remove(C)}function d(t,e){var n=$._data($(t).get(0),"events");return void 0===n?0:n[e].length}var f=document.querySelectorAll("#rate span"),v=document.getElementById("landpage"),h=document.getElementById("aboutUsButton"),p=(document.getElementById("loginAlert"),$("#formNewComment")),g=document.getElementById("formNewCommentWrapper"),y=document.getElementsByClassName("comments-wrapper__comment"),b="display--none",_="visibility--visible",w="form-new-comment--wrapper--visible",C="rate-by-stars--hover",x="comments-wrapper__comment--half-visible",L="collapse__buttons--active",E="landpage--visible",T=".content__dropdown-wrapper",k=".dropdown-wrapper__menu",B=["0","stycznia","lutego","marca","kwietnia","maja","czerwca","lipca","sierpnia","września","października","listopada","grudnia"],A=f.length,N=0,D=4,S=!1,j="https://evening-hamlet-47726.herokuapp.com";/^http\:\/\/localhost/.test(window.location.href)&&(j="http://localhost:3000");var I=function(){function t(){_classCallCheck(this,t),this.today=new Date,this.dd=this.today.getDate(),this.mm=this.today.getMonth()+1,this.yyyy=this.today.getFullYear()}return _createClass(t,[{key:"getDay",value:function(){return this.dd<10&&(this.dd="0"+this.dd),this.dd}},{key:"getMonth",value:function(){return this.mm<10&&(this.mm="0"+this.mm),this.mm}},{key:"getYear",value:function(){return this.yyyy}}]),t}();t(),function(){for(var t=document.getElementsByClassName("show-whole-text"),e=document.getElementsByClassName("PartText"),n=document.getElementsByClassName("wholeText"),o=0,a=t.length;o<a;o++)!function(o,a){t[o].addEventListener("click",function(){e[o].classList.add(b),n[o].classList.remove(b)})}(o)}(),h.addEventListener("click",function(){$(v).remove(),this.classList.add(L)}),"#about-us"===window.location.hash&&(v.classList.remove(E),$(v).remove()),v.addEventListener("transitionend",function(){$(v).remove()}),$("#button-getStarted").one("click",function(){$(this).removeClass("pulse"),v.classList.remove(E),v.classList.add("landpage--hidden"),h.classList.add(L)}),function(){function t(t){f[t].innerHTML="&#9733;",f[t].classList.add(C)}for(var e=0;e<A;e++)f[e].addEventListener("click",function(){N=this.getAttribute("value"),document.querySelector("#rateNum").setAttribute("value",N),u();for(var e=0;e<N;e++)t(e)}),f[e].addEventListener("mouseenter",function(){u();for(var e=0;e<this.getAttribute("value");e++)t(e)}),f[e].addEventListener("mouseleave",function(){u();for(var e=0;e<N;e++)t(e)})}(),e(document),n(),document.getElementById("button-addOpinion").addEventListener("click",function(){this.classList.add("visibility--hidden"),g.classList.add(w)}),$("#button-sendOpinion").click(function(){var t={numOfStars:p.find("#rateNum").val(),commentText:p.find("#text").val(),commentAvatar:p.find("#avatar").val(),commentAuthor:p.find("#currentuser").val()};t.numOfStars&&t.commentText&&o(t)}),i(),r()}();