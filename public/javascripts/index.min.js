"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),initIndex=function(){function t(t){for(var e=t.querySelectorAll(".content__date"),n=new I,o=n.getDay(),a=n.getMonth(),r=n.getYear(),i=0,s=e.length;i<s;i++){var c=new Date(e[i].innerText),l=c.getMinutes(),m=c.getDate(),u=c.getMonth()+1,d=c.getFullYear(),f=o-m,v=c.getHours()+":"+(l<10?"0":"")+l;e[i].innerText=r==d?a==u?0===f?"Dziś o "+v:1===f?"Wczoraj o "+v:f+" dni temu":m+" "+T[u]:m+" "+T[u]+" "+d+" roku",$(e[i]).show(0)}}function e(t){var e=t?$(t):$(document.querySelectorAll(E)),n=e.find(x);e.each(function(){var t=this;$(this).off().on("click",function(){var e=$(t).find(x);n.not(e).removeClass(y),e.toggleClass(y)})}),$(document).on("click",function(t){$(t.target).closest(E).length||n.removeClass(y)})}function n(t){$.ajax({type:"POST",url:N,data:t,success:function(e){t.commentId=e,v[0].reset(),m(),B=0,o(t),a(),i()},error:l})}function o(n){for(var o="",a=$("#commentHiddenTemplate").children().clone()[0],r=0;r<n.numOfStars;r++)o+="&#9733;";a.getElementsByClassName("comment__content")[0].classList.add("comment__content--new","js-new-comment"),a.getElementsByTagName("img")[0].setAttribute("src",n.commentAvatar),a.getElementsByClassName("content__author")[0].innerText=n.commentAuthor,a.getElementsByClassName("content__rate")[0].innerHTML=o,a.getElementsByClassName("content__text")[0].innerText=n.commentText,a.getElementsByClassName("content__date")[0].innerText=Date(),$(a.getElementsByClassName("button-DeleteComment")[0]).parent().attr("data",n.commentId),t(a),$(a.outerHTML).prependTo("#commentsWrapper").promise().done(function(){setTimeout(function(){var t=document.getElementsByClassName("js-new-comment");t[t.length-1].classList.remove("comment__content--new","js-new-comment")},1e4)}),e(document.querySelectorAll(E))}function a(){$(".button-DeleteComment").each(function(){var t=this;$(this).on("click",function(){var e={commentId:$.trim($(t).parent().attr("data"))};$.ajax({type:"DELETE",url:N,data:e,success:r($(t)),error:l})})})}function r(t){t.closest(".comments-wrapper__comment").remove(),D||(A<p.length&&p[A].classList.remove(w),A+1<p.length&&(p[A+1].classList.remove(g),p[A+1].classList.add(w)))}function i(){var t=$(".button-EditComment"),e=$(document.querySelectorAll(".dropdown-wrapper__button"));t.each(function(){var t=this;$(this).on("click",function(){var n={commentId:$(t).parent().attr("data")},o=$(t).closest("div.comments-wrapper__comment"),a=o.find("div.content__text"),r=a.text().trim(),i="<form id='edit-form' class='content__edit-form'>\n                            <textarea id='text-area' class='edit-form__textarea'>"+r+"</textarea>\n                            <div class='edit-form__buttons-container'>\n                              <button type='button' id='buttonAccept' class='button button--small button--accept'>Zatwierdź</button>\n                              <button type='button' id='buttonCancel' class='button button--small button--cancel'>Anuluj</button>\n                            </div>\n                          </form>";e.addClass(g),a.replaceWith(i).promise().done(function(){var t=o.find("#edit-form");o.find("#buttonAccept").on("click",function(){n.editFormText=t.find("#text-area").val();var o=a.text(n.editFormText),i={editForm:t,newTextDiv:o,btnToggleDropdown:e};n.editFormText!==r&&s(n,i)}),o.find("#buttonCancel").on("click",function(){t.replaceWith(a),e.removeClass(g)})})})})}function s(t,e){$.ajax({type:"PUT",url:N,data:t,success:function(){c(e)},error:l})}function c(t){t.editForm.replaceWith(t.newTextDiv),t.btnToggleDropdown.removeClass(g)}function l(t,e,n){console.log("Error",t,e,n)}function m(){for(var t=0;t<k;t++)u[t].innerHTML="&#9734;",u[t].classList.remove(_)}var u=document.querySelectorAll("#rate span"),d=document.getElementById("landpage"),f=document.getElementById("aboutUsButton"),v=(document.getElementById("loginAlert"),$("#formNewComment")),h=document.getElementById("formNewCommentWrapper"),p=document.getElementsByClassName("comments-wrapper__comment"),g="display--none",y="visibility--visible",b="form-new-comment--wrapper--visible",_="rate-by-stars--hover",w="comments-wrapper__comment--half-visible",C="collapse__buttons--active",L="landpage--visible",E=".content__dropdown-wrapper",x=".dropdown-wrapper__menu",T=["0","stycznia","lutego","marca","kwietnia","maja","czerwca","lipca","sierpnia","września","października","listopada","grudnia"],k=u.length,A=4,B=0,D=!1,N="https://evening-hamlet-47726.herokuapp.com";/^http\:\/\/localhost/.test(window.location.href)&&(N="http://localhost:3000");var I=function(){function t(){_classCallCheck(this,t),this.today=new Date,this.dd=this.today.getDate(),this.mm=this.today.getMonth()+1,this.yyyy=this.today.getFullYear()}return _createClass(t,[{key:"getDay",value:function(){return this.dd<10&&(this.dd="0"+this.dd),this.dd}},{key:"getMonth",value:function(){return this.mm<10&&(this.mm="0"+this.mm),this.mm}},{key:"getYear",value:function(){return this.yyyy}}]),t}();p.length>A&&document.getElementById("showAllComments").addEventListener("click",function(){D=!0,this.classList.add(g),p[A+1].classList.remove(w);for(var t=A+2,e=p.length;t<e;t++)p[t].classList.remove(g)}),f.addEventListener("click",function(){d.remove(),this.classList.add(C)}),"#about-us"===window.location.hash&&(d.classList.remove(L),d.remove()),d.addEventListener("transitionend",function(){this.remove()}),$("#button-getStarted").one("click",function(){$(this).removeClass("pulse"),d.classList.remove(L),d.classList.add("landpage--hidden"),f.classList.add(C)}),function(){function t(t){u[t].innerHTML="&#9733;",u[t].classList.add(_)}for(var e=0;e<k;e++)u[e].addEventListener("click",function(){B=this.getAttribute("value"),document.querySelector("#rateNum").setAttribute("value",B),m();for(var e=0;e<B;e++)t(e)}),u[e].addEventListener("mouseenter",function(){m();for(var e=0;e<this.getAttribute("value");e++)t(e)}),u[e].addEventListener("mouseleave",function(){m();for(var e=0;e<B;e++)t(e)})}(),t(document),e(),document.getElementById("button-addOpinion").addEventListener("click",function(){this.classList.add("visibility--hidden"),h.classList.add(b)}),$("#button-sendOpinion").click(function(){var t={numOfStars:v.find("#rateNum").val(),commentText:v.find("#text").val(),commentAvatar:v.find("#avatar").val(),commentAuthor:v.find("#currentuser").val()};t.numOfStars&&t.commentText&&n(t)}),a(),i()}();