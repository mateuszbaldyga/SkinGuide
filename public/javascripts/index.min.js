"use strict";function init(){setNavigationForAboutUsButton(),hideLandingPage(),landpageIsHiddenIsTRUE(),rateComment(),dateFormat(document),showHideDropdownMenu(),addOpinionButtonAction(),addFunctionPostComment(),addFunctionDestroyComment(),addFunctionEditComment()}function setNavigationForAboutUsButton(){aboutUsButton.addEventListener("click",function(){landpage.remove(),landpageIsHidden=!0,this.classList.add("collapse__buttons--active")})}function hideLandingPage(){landpage.addEventListener("transitionend",function(){this.remove(),landpageIsHidden=!0}),$("#button-getStarted").one("click",function(){$(this).removeClass("pulse"),landpage.classList.add("landpage--hidden"),aboutUsButton.classList.add("collapse__buttons--active")})}function landpageIsHiddenIsTRUE(){"#about-us"===window.location.hash&&(landpageIsHidden=!0)}function rateComment(){function t(t){stars[t].innerHTML="&#9733;",stars[t].classList.add(rateByStarsHover)}for(var e=0;e<starsQuantity;e++)stars[e].addEventListener("click",function(){clickedStar=this.getAttribute("value"),document.querySelector("#rateNum").setAttribute("value",clickedStar),resetStars();for(var e=0;e<clickedStar;e++)t(e)}),stars[e].addEventListener("mouseenter",function(){resetStars();for(var e=0;e<this.getAttribute("value");e++)t(e)}),stars[e].addEventListener("mouseleave",function(){resetStars();for(var e=0;e<clickedStar;e++)t(e)})}function dateFormat(t){for(var e=t.querySelectorAll(".content__date"),n=Date.now(),o=0,a=e.length;o<a;o++){var r=new Date(e[o].innerText),i=r.getMinutes(),s=r.getHours()+":"+(i<10?"0":"")+i,d=r.getTime(),m=Math.floor((n-d)/864e5);e[o].innerText=m<=1?"Dziś o "+s:m<=2?"Wczoraj o "+s:m<=30?m+" dni temu":r.getDate()+" "+months[r.getMonth()],$(e[o]).show(0)}}function showHideDropdownMenu(t){var e=t?$(t):$(document.querySelectorAll(".content__dropdown-wrapper")),n=e.find(".dropdown-wrapper__menu");e.each(function(){var t=this;$(this).off().on("click",function(){var e=$(t).find(".dropdown-wrapper__menu");n.not(e).removeClass("visibility--visible"),e.toggleClass("visibility--visible")})}),$(document).on("click",function(t){$(t.target).closest(".content__dropdown-wrapper").length||n.removeClass("visibility--visible")})}function addOpinionButtonAction(){document.getElementById("button-addOpinion").addEventListener("click",function(){this.classList.add("visibility--hidden"),formNewCommentWrapper.classList.add(formNewCommentWrapperVisible)})}function addFunctionPostComment(){$("#button-sendOpinion").click(function(){var t={numOfStars:formNewComment.find("#rateNum").val(),commentText:formNewComment.find("#text").val(),commentAvatar:formNewComment.find("#avatar").val(),commentAuthor:formNewComment.find("#currentuser").val()};t.numOfStars&&t.commentText&&postCommentToDatabase(t)})}function postCommentToDatabase(t){$.ajax({type:"POST",url:"https://evening-hamlet-47726.herokuapp.com/",data:t,headers:{"X-Requested-With":"XMLHttpRequest"},success:function(e){t.commentId=e,formNewComment[0].reset(),resetStars(),clickedStar=0,displayPostedComment(t),addFunctionDestroyComment(),addFunctionEditComment()},error:error})}function displayPostedComment(t){for(var e="",n=$("#commentHiddenTemplate").children().clone()[0],o=0;o<t.numOfStars;o++)e+="&#9733;";n.getElementsByTagName("img")[0].setAttribute("src",t.commentAvatar),n.getElementsByClassName("content__author")[0].innerText=t.commentAuthor,n.getElementsByClassName("content__rate")[0].innerHTML=e,n.getElementsByClassName("content__text")[0].innerText=t.commentText,n.getElementsByClassName("content__date")[0].innerText=Date(),$(n.getElementsByClassName("button-DeleteComment")[0]).parent().attr("data",t.commentId),dateFormat(n),$(n.outerHTML).appendTo("#commentsWrapper"),showHideDropdownMenu(document.querySelectorAll(".content__dropdown-wrapper"))}function addFunctionDestroyComment(){$(".button-DeleteComment").each(function(){var t=this;$(this).on("click",function(){var e={commentId:$.trim($(t).parent().attr("data"))};$.ajax({url:"https://evening-hamlet-47726.herokuapp.com",data:e,type:"DELETE",success:function(){$(t).closest(".comments-wrapper__comment").remove()},error:error})})})}function addFunctionEditComment(){var t=$(".button-EditComment"),e=$(document.querySelectorAll(".dropdown-wrapper__button"));t.each(function(){var t=this;$(this).on("click",function(){var n={commentId:$(t).parent().attr("data")},o=$(t).closest("div.comments-wrapper__comment"),a=o.find("div.content__text"),r=a.text().trim(),i="<form id='edit-form' class='content__edit-form'>\n                        <textarea id='text-area' class='edit-form__textarea'>"+r+"</textarea>\n                        <div class='edit-form__buttons-container'>\n                          <button type='button' id='buttonAccept' class='button button--small button--accept'>Zatwierdź</button>\n                          <button type='button' id='buttonCancel' class='button button--small button--cancel'>Anuluj</button>\n                        </div>\n                      </form>";e.addClass("display--none"),a.replaceWith(i).promise().done(function(){var t=o.find("#edit-form");o.find("#buttonAccept").on("click",function(){n.editFormText=t.find("#text-area").val();var o=a.text(n.editFormText),i={editForm:t,newTextDiv:o,btnToggleDropdown:e};n.editFormText!==r&&updateCommentToDatabase(n,i)}),o.find("#buttonCancel").on("click",function(){t.replaceWith(a),e.removeClass("display--none")})})})})}function updateCommentToDatabase(t,e){$.ajax({type:"PUT",url:"https://evening-hamlet-47726.herokuapp.com",data:t,headers:{"X-Requested-With":"XMLHttpRequest"},success:function(){displayEditedComment(e)},error:error})}function displayEditedComment(t){t.editForm.replaceWith(t.newTextDiv),t.btnToggleDropdown.removeClass("display--none")}function error(t,e,n){console.log("Error")}function resetStars(){for(var t=0;t<starsQuantity;t++)stars[t].innerHTML="&#9734;",stars[t].classList.remove(rateByStarsHover)}var stars=document.querySelectorAll("#rate span"),starsQuantity=stars.length,landpage=document.getElementById("landpage"),aboutUsButton=document.getElementById("aboutUsButton"),loginAlert=document.getElementById("loginAlert"),formNewComment=$("#formNewComment"),formNewCommentWrapper=document.getElementById("formNewCommentWrapper"),months=["stycznia","lutego","marca","kwietnia","maja","czerwca","lipca","sierpnia","września","października","listopada","grudnia"],formNewCommentWrapperVisible="form-new-comment--wrapper--visible",rateByStars="rate-by-stars",rateByStarsHover="rate-by-stars--hover",clickedStar=0;landpageIsHidden=!1,init();