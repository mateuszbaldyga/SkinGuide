"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();!function(){function e(e){for(var t=e.querySelectorAll(".content__date"),n=new I,o=n.getDay(),a=n.getMonth(),r=n.getYear(),s=0,i=t.length;s<i;s++){var c=new Date(t[s].innerText),m=c.getMinutes(),l=c.getDate(),d=c.getMonth()+1,u=c.getFullYear(),f=o-l,p=c.getHours()+":"+(m<10?"0":"")+m;t[s].innerText=r==u?a==d?0===f?"Dziś o "+p:1===f?"Wczoraj o "+p:f+" dni temu":l+" "+w[d]:l+" "+w[d]+" "+u,$(t[s]).show(0)}}function t(e){$.ajax({type:"POST",url:N,data:e,success:function(t){e.commentId=t,c[0].reset(),a(),L=0,n(e),C.push(e.commentText),E++,A=$(b)},error:o})}function n(t){for(var n="",o=$("#commentHiddenTemplate").children().clone()[0],a=0;a<t.numOfStars;a++)n+="&#9733;";o.getElementsByClassName("comment__content")[0].classList.add("comment__content--new","js-new-comment"),o.getElementsByTagName("img")[0].setAttribute("src",t.commentAvatar),o.getElementsByClassName("content__author")[0].innerText=t.commentAuthor,o.getElementsByClassName("content__rate")[0].innerHTML=n,o.getElementsByClassName("content__text")[0].innerText=t.commentText,o.getElementsByClassName("content__date")[0].innerText=Date();var r=o.getElementsByClassName("dropdown-wrapper__menu")[0];r.setAttribute("data-commentId",t.commentId),r.setAttribute("data-comIndex",E),e(o),$(o.outerHTML).prependTo(_).promise().done(function(){setTimeout(function(){var e=document.getElementsByClassName("js-new-comment");e.length>0&&e[e.length-1].classList.remove("comment__content--new","js-new-comment")},1e4)})}function o(e,t,n){console.log("Error",e,t,n)}function a(){for(var e=0;e<x;e++)r[e].innerHTML="&#9734;",r[e].classList.remove(p)}for(var r=document.querySelectorAll("#rate span"),s=document.getElementById("landpage"),i=document.getElementById("aboutUsButton"),c=(document.getElementById("loginAlert"),$("#formNewComment")),m=document.getElementById("formNewCommentWrapper"),l=document.querySelectorAll(".panel--comments__comments-wrapper .comments-wrapper__comment"),d="display--none",u="visibility--visible",f="form-new-comment--wrapper--visible",p="rate-by-stars--hover",v="comments-wrapper__comment--half-visible",h="collapse__buttons--active",g="landpage--visible",y=".content__dropdown-wrapper",b=".dropdown-wrapper__menu",_="#commentsWrapper",w=["0","stycznia","lutego","marca","kwietnia","maja","czerwca","lipca","sierpnia","września","października","listopada","grudnia"],x=r.length,L=0,E=l.length,T=!1,N="https://evening-hamlet-47726.herokuapp.com",C=[],A=$(b),k=l.length-1;k>=0;k--)C.push(l[k].childNodes[3].childNodes[7].innerText.trim());/^http\:\/\/localhost/.test(window.location.href)&&(N="http://localhost:3000");var I=function(){function e(){_classCallCheck(this,e),this.today=new Date,this.dd=this.today.getDate(),this.mm=this.today.getMonth()+1,this.yyyy=this.today.getFullYear()}return _createClass(e,[{key:"getDay",value:function(){return this.dd<10&&(this.dd="0"+this.dd),this.dd}},{key:"getMonth",value:function(){return this.mm<10&&(this.mm="0"+this.mm),this.mm}},{key:"getYear",value:function(){return this.yyyy}}]),e}();!function(){for(var e=0;e<E;e++){var t=l[e].childNodes[3].childNodes[7],n=t.innerText.trim();if(n.length>150){var o='<button class="show-whole-text" data-comIndex="'+(E-1-e)+'">...zobacz więcej</button>';t.innerText=n.slice(0,150)+"(..)",t.insertAdjacentHTML("beforeend",o)}}}(),$(_).on("click",".show-whole-text",function(){var e=this.getAttribute("data-comIndex");this.parentNode.innerText=C[e]}),$(_).on("click",".comments-wrapper__comment--half-visible",function(){var e=document.querySelectorAll(".comments-wrapper__comment.display--none");this.classList.remove(v),T=!0;for(var t=0,n=e.length;t<n;t++)e[t].classList.remove(d)}),i.addEventListener("click",function(){$(s).remove(),this.classList.add(h)}),"#about-us"===window.location.hash&&(s.classList.remove(g),$(s).remove()),s.addEventListener("transitionend",function(){$(s).remove()}),$("#button-getStarted").one("click",function(){$(this).removeClass("pulse"),s.classList.remove(g),s.classList.add("landpage--hidden"),i.classList.add(h)}),function(){function e(e){r[e].innerHTML="&#9733;",r[e].classList.add(p)}for(var t=0;t<x;t++)r[t].addEventListener("click",function(){L=this.getAttribute("value"),document.querySelector("#rateNum").setAttribute("value",L),a();for(var t=0;t<L;t++)e(t)}),r[t].addEventListener("mouseenter",function(){a();for(var t=0;t<this.getAttribute("value");t++)e(t)}),r[t].addEventListener("mouseleave",function(){a();for(var t=0;t<L;t++)e(t)})}(),e(document),$(_).on("click",y,function(){var e=$(this).find(b);A.not(e).removeClass(u),e.toggleClass(u)}),$(document).on("click",function(e){$(e.target).closest(y).length||A.removeClass(u)}),document.getElementById("button-addOpinion").addEventListener("click",function(){this.classList.add("visibility--hidden"),m.classList.add(f)}),$("#button-sendOpinion").click(function(){var e={numOfStars:c.find("#rateNum").val(),commentText:c.find("#text").val(),commentAvatar:c.find("#avatar").val(),commentAuthor:c.find("#currentuser").val()};e.numOfStars&&e.commentText&&t(e)}),$(_).on("click",".button-DeleteComment",function(){function e(e){var t=e.parentNode.parentNode.parentNode;t.parentNode.removeChild(t)}function t(){if(!T){var e=document.querySelector(".comments-wrapper__comment.comments-wrapper__comment--half-visible"),t=document.querySelector(".comments-wrapper__comment.display--none");e&&(e.classList.remove(v),t&&(t.classList.remove(d),t.classList.add(v)))}}var n=this,a={commentId:this.parentNode.getAttribute("data-commentId")};$.ajax({type:"DELETE",url:N,data:a,success:function(){e(n),t()},error:o})}),function(){var e=document.getElementsByClassName("dropdown-wrapper__button"),t={};$(_).on("click",".button-EditComment",function(){function n(e,t){for(var n=0,o=e.length;n<o;n++)"add"===t?e[n].classList.add(d):e[n].classList.remove(d)}function a(e){$.ajax({type:"PUT",url:N,data:e,success:function(){r(e.newText)},error:o})}function r(e){c.innerText=e,C[s]=e}var s=this.parentNode.getAttribute("data-comIndex"),i="<form id='edit-form' class='content__edit-form'>\n                        <textarea id='text-area' class='edit-form__textarea'>"+C[s]+"</textarea>\n                        <div class='edit-form__buttons-container'>\n                          <button type='button' id='buttonAccept' class='button button--small button--accept'>Zatwierdź</button>\n                          <button type='button' id='buttonCancel' class='button button--small button--cancel'>Anuluj</button>\n                        </div>\n                      </form>",c=this.parentNode.parentNode.parentNode.childNodes[3].childNodes[7];t.commentId=this.parentNode.getAttribute("data-commentId"),c.innerHTML=i,document.getElementById("buttonAccept").addEventListener("click",function(){t.newText=document.getElementById("text-area").value,a(t),n(e,"remove")}),document.getElementById("buttonCancel").addEventListener("click",function(){c.innerText=C[s],n(e,"remove")}),n(e,"add")})}()}();