"use strict";var initIndex=function(){function t(t){for(var e=t.querySelectorAll(".content__date"),n=Date.now(),o=0,a=e.length;o<a;o++){var i=new Date(e[o].innerText),r=i.getMinutes(),c=i.getHours()+":"+(r<10?"0":"")+r,s=i.getTime(),l=Math.floor((n-s)/864e5);e[o].innerText=l<=1?"Dziś o "+c:l<=2?"Wczoraj o "+c:l<=30?l+" dni temu":i.getDate()+" "+b[i.getMonth()],$(e[o]).show(0)}}function e(t){var e=t?$(t):$(document.querySelectorAll(".content__dropdown-wrapper")),n=e.find(".dropdown-wrapper__menu");e.each(function(){var t=this;$(this).off().on("click",function(){var e=$(t).find(".dropdown-wrapper__menu");n.not(e).removeClass("visibility--visible"),e.toggleClass("visibility--visible")})}),$(document).on("click",function(t){$(t.target).closest(".content__dropdown-wrapper").length||n.removeClass("visibility--visible")})}function n(t){$.ajax({type:"POST",url:y,data:t,success:function(e){t.commentId=e,p[0].reset(),l(),_=0,o(t),a(),i()},error:s})}function o(n){for(var o="",a=$("#commentHiddenTemplate").children().clone()[0],i=0;i<n.numOfStars;i++)o+="&#9733;";a.getElementsByTagName("img")[0].setAttribute("src",n.commentAvatar),a.getElementsByClassName("content__author")[0].innerText=n.commentAuthor,a.getElementsByClassName("content__rate")[0].innerHTML=o,a.getElementsByClassName("content__text")[0].innerText=n.commentText,a.getElementsByClassName("content__date")[0].innerText=Date(),$(a.getElementsByClassName("button-DeleteComment")[0]).parent().attr("data",n.commentId),t(a),$(a.outerHTML).appendTo("#commentsWrapper"),e(document.querySelectorAll(".content__dropdown-wrapper"))}function a(){$(".button-DeleteComment").each(function(){var t=this;$(this).on("click",function(){var e={commentId:$.trim($(t).parent().attr("data"))};$.ajax({type:"DELETE",url:y,data:e,success:function(){$(t).closest(".comments-wrapper__comment").remove()},error:s})})})}function i(){var t=$(".button-EditComment"),e=$(document.querySelectorAll(".dropdown-wrapper__button"));t.each(function(){var t=this;$(this).on("click",function(){var n={commentId:$(t).parent().attr("data")},o=$(t).closest("div.comments-wrapper__comment"),a=o.find("div.content__text"),i=a.text().trim(),c="<form id='edit-form' class='content__edit-form'>\n                            <textarea id='text-area' class='edit-form__textarea'>"+i+"</textarea>\n                            <div class='edit-form__buttons-container'>\n                              <button type='button' id='buttonAccept' class='button button--small button--accept'>Zatwierdź</button>\n                              <button type='button' id='buttonCancel' class='button button--small button--cancel'>Anuluj</button>\n                            </div>\n                          </form>";e.addClass("display--none"),a.replaceWith(c).promise().done(function(){var t=o.find("#edit-form");o.find("#buttonAccept").on("click",function(){n.editFormText=t.find("#text-area").val();var o=a.text(n.editFormText),c={editForm:t,newTextDiv:o,btnToggleDropdown:e};n.editFormText!==i&&r(n,c)}),o.find("#buttonCancel").on("click",function(){t.replaceWith(a),e.removeClass("display--none")})})})})}function r(t,e){$.ajax({type:"PUT",url:y,data:t,success:function(){c(e)},error:s})}function c(t){t.editForm.replaceWith(t.newTextDiv),t.btnToggleDropdown.removeClass("display--none")}function s(t,e,n){console.log("Error",t,e,n)}function l(){for(var t=0;t<m;t++)d[t].innerHTML="&#9734;",d[t].classList.remove(g)}var d=document.querySelectorAll("#rate span"),m=d.length,u=document.getElementById("landpage"),f=document.getElementById("aboutUsButton"),p=(document.getElementById("loginAlert"),$("#formNewComment")),v=document.getElementById("formNewCommentWrapper"),b=["stycznia","lutego","marca","kwietnia","maja","czerwca","lipca","sierpnia","września","października","listopada","grudnia"],h="form-new-comment--wrapper--visible",g="rate-by-stars--hover",_=0,y="https://evening-hamlet-47726.herokuapp.com";/^http\:\/\/localhost/.test(window.location.href)&&(y="http://localhost:3000"),f.addEventListener("click",function(){u.remove(),this.classList.add("collapse__buttons--active")}),u.addEventListener("transitionend",function(){this.remove()}),$("#button-getStarted").one("click",function(){$("main").addClass("display--block"),$("footer").addClass("display--block"),$(this).removeClass("pulse"),u.classList.add("landpage--hidden"),f.classList.add("collapse__buttons--active")}),function(){function t(t){d[t].innerHTML="&#9733;",d[t].classList.add(g)}for(var e=0;e<m;e++)d[e].addEventListener("click",function(){_=this.getAttribute("value"),document.querySelector("#rateNum").setAttribute("value",_),l();for(var e=0;e<_;e++)t(e)}),d[e].addEventListener("mouseenter",function(){l();for(var e=0;e<this.getAttribute("value");e++)t(e)}),d[e].addEventListener("mouseleave",function(){l();for(var e=0;e<_;e++)t(e)})}(),t(document),e(),document.getElementById("button-addOpinion").addEventListener("click",function(){this.classList.add("visibility--hidden"),v.classList.add(h)}),$("#button-sendOpinion").click(function(){var t={numOfStars:p.find("#rateNum").val(),commentText:p.find("#text").val(),commentAvatar:p.find("#avatar").val(),commentAuthor:p.find("#currentuser").val()};t.numOfStars&&t.commentText&&n(t)}),a(),i()}();